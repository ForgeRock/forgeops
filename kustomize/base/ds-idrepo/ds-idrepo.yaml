# Sample DirectoryService deployment
apiVersion: directory.forgerock.io/v1alpha1
kind: DirectoryService
metadata:
  name: ds-idrepo
spec:
  # The number of DS servers in the topology
  replicas: 1
  podTemplate:
    image: gcr.io/forgeops-public/ds:7.2.0
    imagePullPolicy: IfNotPresent

    # The resources assigned to each DS pod
    resources:
      requests:
        memory: 900Mi
        cpu: 500m
      limits:
        memory: 1024Mi

    # Kubernetes secrets holding the certificates and keys for directory server operation.
    # Secrets can be generated by cert-manager or other tools that generate
    # PEM based secrets of type kubernetes.io/tls.
    secrets:
      # the tls.key in this secret is the private key used for encrypting DS data.
      # BACK THIS UP!! If you lose this secret your data will be lost forever.
      masterSecretName: ds-master-keypair
      # tls.key and tls.crt used for SSL connections between ds instances - for replication, etc.
      sslSecretName: ds-ssl-keypair
      # The truststore is taken from the ca.crt in the tls secret. In most cases
      # you can use the same CA trust pem in the ssl secret above. If you are using
      # cert-manager, it includes the CA trust pem along with the private/public key pair.
      truststoreSecretName: ds-ssl-keypair

    # The volume spec for the DS data. This is the same as the Kubernetes PVC volume spec.
    volumeClaimSpec:
      storageClassName: standard
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 10Gi

  ### Passwords ###
  # Passwords: maps DS accounts to new or existing secrets.
  # The operator supports "bring your own secrets". For example, a secret may have been generated by another operator such as secret agent.
  # A secret that does not set create: true is assumed to be supplied externally. External secrets will not be deleted by the operator
  passwords:
    # uid=admin and uid=monitor are required account secrets.
    uid=admin:
      secretName: ds-passwords
      key: dirmanager.pw
    uid=monitor:
      secretName: ds-passwords
      key: monitor.pw
      # example of letting the operator generate the secret:
      #create: true

    # Set the service account passwords
    # We also set the CTS account - in case the user wants to use a single ds instance
    uid=openam_cts,ou=admins,ou=famrecords,ou=openam-session,ou=tokens:
      secretName: ds-env-secrets
      key: AM_STORES_CTS_PASSWORD
    uid=am-identity-bind-account,ou=admins,ou=identities:
      secretName: ds-env-secrets
      key: AM_STORES_USER_PASSWORD
    uid=am-config,ou=admins,ou=am-config:
      secretName: ds-env-secrets
      key: AM_STORES_APPLICATION_PASSWORD
