{
  "metadata" : {
    "realm" : "/",
    "amsterVersion" : "&{version}",
    "entityType" : "Scripts",
    "entityId" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "pathParams" : { }
  },
  "data" : {
    "_id" : "36863ffb-40ec-48b9-94b1-9a99f71cc3b5",
    "name" : "OIDC Claims Script",
    "description" : "Default global script for OIDC claims",
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMTQtMjAxNyBGb3JnZVJvY2sgQVMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQKICoKICogVXNlIG9mIHRoaXMgY29kZSByZXF1aXJlcyBhIGNvbW1lcmNpYWwgc29mdHdhcmUgbGljZW5zZSB3aXRoIEZvcmdlUm9jayBBUy4KICogb3Igd2l0aCBvbmUgb2YgaXRzIGFmZmlsaWF0ZXMuIEFsbCB1c2Ugc2hhbGwgYmUgZXhjbHVzaXZlbHkgc3ViamVjdAogKiB0byBzdWNoIGxpY2Vuc2UgYmV0d2VlbiB0aGUgbGljZW5zZWUgYW5kIEZvcmdlUm9jayBBUy4KICovCmltcG9ydCBjb20uaXBsYW5ldC5zc28uU1NPRXhjZXB0aW9uCmltcG9ydCBjb20uc3VuLmlkZW50aXR5LmlkbS5JZFJlcG9FeGNlcHRpb24KaW1wb3J0IG9yZy5mb3JnZXJvY2sub2F1dGgyLmNvcmUuZXhjZXB0aW9ucy5JbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbgppbXBvcnQgb3JnLmZvcmdlcm9jay5vYXV0aDIuY29yZS5Vc2VySW5mb0NsYWltcwppbXBvcnQgb3JnLmZvcmdlcm9jay5vcGVuaWRjb25uZWN0LkNsYWltCgovKgoqIERlZmluZWQgdmFyaWFibGVzOgoqIGxvZ2dlciAtIGFsd2F5cyBwcmVzZW50cywgdGhlICJPQXV0aDJQcm92aWRlciIgZGVidWcgbG9nZ2VyIGluc3RhbmNlCiogY2xhaW1zIC0gYWx3YXlzIHByZXNlbnQsIGRlZmF1bHQgc2VydmVyIHByb3ZpZGVkIGNsYWltcyAtIE1hcDxTdHJpbmcsIE9iamVjdD4KKiBjbGFpbU9iamVjdHMgLSBhbHdheXMgcHJlc2VudCwgZGVmYXVsdCBzZXJ2ZXIgcHJvdmlkZWQgY2xhaW1zIC0gTGlzdDxDbGFpbT4KKiBzZXNzaW9uIC0gcHJlc2VudCBpZiB0aGUgcmVxdWVzdCBjb250YWlucyB0aGUgc2Vzc2lvbiBjb29raWUsIHRoZSB1c2VyJ3Mgc2Vzc2lvbiBvYmplY3QKKiBpZGVudGl0eSAtIGFsd2F5cyBwcmVzZW50LCB0aGUgaWRlbnRpdHkgb2YgdGhlIHJlc291cmNlIG93bmVyCiogc2NvcGVzIC0gYWx3YXlzIHByZXNlbnQsIHRoZSByZXF1ZXN0ZWQgc2NvcGVzCiogcmVxdWVzdGVkQ2xhaW1zIC0gTWFwPFN0cmluZywgU2V0PFN0cmluZz4+CiogICAgICAgICAgICAgICAgICBhbHdheXMgcHJlc2VudCwgbm90IGVtcHR5IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIGEgY2xhaW1zIHBhcmFtZXRlciBhbmQgc2VydmVyIGhhcyBlbmFibGVkCiogICAgICAgICAgICAgICAgICBjbGFpbXNfcGFyYW1ldGVyX3N1cHBvcnRlZCwgbWFwIG9mIHJlcXVlc3RlZCBjbGFpbXMgdG8gcG9zc2libGUgdmFsdWVzLCBvdGhlcndpc2UgZW1wdHksCiogICAgICAgICAgICAgICAgICByZXF1ZXN0ZWQgY2xhaW1zIHdpdGggbm8gcmVxdWVzdGVkIHZhbHVlcyB3aWxsIGhhdmUgYSBrZXkgYnV0IG5vIHZhbHVlIGluIHRoZSBtYXAuIEEga2V5IHdpdGgKKiAgICAgICAgICAgICAgICAgIGEgc2luZ2xlIHZhbHVlIGluIGl0cyBTZXQgaW5kaWNhdGVzIHRoaXMgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBzaG91bGQgYmUgcmV0dXJuZWQuCiogcmVxdWVzdGVkVHlwZWRDbGFpbXMgLSBMaXN0PENsYWltPgoqICAgICAgICAgICAgICAgICAgICAgICBhbHdheXMgcHJlc2VudCwgbm90IGVtcHR5IGlmIHRoZSByZXF1ZXN0IGNvbnRhaW5zIGEgY2xhaW1zIHBhcmFtZXRlciBhbmQgc2VydmVyIGhhcyBlbmFibGVkCiogICAgICAgICAgICAgICAgICAgICAgIGNsYWltc19wYXJhbWF0ZXJfc3VwcG9ydGVkLCBsaXN0IG9mIHJlcXVlc3RlZCBjbGFpbXMgd2l0aCBjbGFpbSBuYW1lLCByZXF1ZXN0ZWQgcG9zc2libGUgdmFsdWVzCiogICAgICAgICAgICAgICAgICAgICAgIGFuZCBpZiBjbGFpbSBpcyBlc3NlbnRpYWwsIG90aGVyd2lzZSBlbXB0eSwKKiAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkIGNsYWltcyB3aXRoIG5vIHJlcXVlc3RlZCB2YWx1ZXMgd2lsbCBoYXZlIGEgY2xhaW0gd2l0aCBubyB2YWx1ZXMuIEEgY2xhaW1zIHdpdGgKKiAgICAgICAgICAgICAgICAgICAgICAgYSBzaW5nbGUgdmFsdWUgaW5kaWNhdGVzIHRoaXMgaXMgdGhlIG9ubHkgdmFsdWUgdGhhdCBzaG91bGQgYmUgcmV0dXJuZWQuCiogY2xhaW1zTG9jYWxlcyAtIHRoZSB2YWx1ZXMgZnJvbSB0aGUgJ2NsYWltc19sb2NhbGVzJyBwYXJhbWV0ZXIgLSBMaXN0PFN0cmluZz4KKiBSZXF1aXJlZCB0byByZXR1cm4gYSBNYXAgb2YgY2xhaW1zIHRvIGJlIGFkZGVkIHRvIHRoZSBpZF90b2tlbiBjbGFpbXMKKgoqIEV4cGVjdGVkIHJldHVybiB2YWx1ZSBzdHJ1Y3R1cmU6CiogVXNlckluZm9DbGFpbXMgewoqICAgIE1hcDxTdHJpbmcsIE9iamVjdD4gdmFsdWVzOyAvLyBUaGUgdmFsdWVzIG9mIHRoZSBjbGFpbXMgZm9yIHRoZSB1c2VyIGluZm9ybWF0aW9uCiogICAgTWFwPFN0cmluZywgTGlzdDxTdHJpbmc+PiBjb21wb3NpdGVTY29wZXM7IC8vIE1hcHBpbmcgb2Ygc2NvcGUgbmFtZSB0byBhIGxpc3Qgb2YgY2xhaW0gbmFtZXMuCiogfQoqLwoKLy8gdXNlciBzZXNzaW9uIG5vdCBndWFyYW50ZWVkIHRvIGJlIHByZXNlbnQKYm9vbGVhbiBzZXNzaW9uUHJlc2VudCA9IHNlc3Npb24gIT0gbnVsbAoKLyoKICogUHVsbHMgZmlyc3QgdmFsdWUgZnJvbSB1c2VycyBwcm9maWxlIGF0dHJpYnV0ZQogKgogKiBAcGFyYW0gY2xhaW0gVGhlIGNsYWltIG9iamVjdC4KICogQHBhcmFtIGF0dHIgVGhlIHByb2ZpbGUgYXR0cmlidXRlIG5hbWUuCiAqLwpkZWYgZnJvbVNldCA9IHsgY2xhaW0sIGF0dHIgLT4KICAgIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPT0gMSl7CiAgICAgICAgYXR0ci5pdGVyYXRvcigpLm5leHQoKQogICAgfSBlbHNlIGlmIChhdHRyICE9IG51bGwgJiYgYXR0ci5zaXplKCkgPiAxKXsKICAgICAgICBhdHRyCiAgICB9IGVsc2UgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgbG9nZ2VyLndhcm5pbmcoIk9wZW5BTVNjb3BlVmFsaWRhdG9yLmdldFVzZXJJbmZvKCk6IEdvdCBhbiBlbXB0eSByZXN1bHQgZm9yIGNsYWltPSRjbGFpbSIpOwogICAgfQp9CgovLyAtLS12dnZ2dnZ2dnZ2LS0tIEVYQU1QTEUgQ0xBSU0gQVRUUklCVVRFIFJFU09MVkVSIEZVTkNUSU9OUyAtLS12dnZ2dnZ2dnZ2LS0tCi8qCiAqIENsYWltIHJlc29sdmVyIHdoaWNoIHJlc29sdmVzIHRoZSB2YWx1ZSBvZiB0aGUgY2xhaW0gZnJvbSBpdHMgcmVxdWVzdGVkIHZhbHVlcy4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGlmIHRoZSBjbGFpbSBoYXMgb25lIHJlcXVlc3RlZCB2YWx1ZXMsIG90aGVyd2lzZSBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KZGVmYXVsdENsYWltUmVzb2x2ZXIgPSB7IGNsYWltIC0+CiAgICBpZiAoY2xhaW0uZ2V0VmFsdWVzKCkuc2l6ZSgpID09IDEpIHsKICAgICAgICBbKGNsYWltLmdldE5hbWUoKSk6IGNsYWltLmdldFZhbHVlcygpLml0ZXJhdG9yKCkubmV4dCgpXQogICAgfSBlbHNlIHsKICAgICAgICBbOl0KICAgIH0KfQoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggcmVzb2x2ZXMgdGhlIHZhbHVlIG9mIHRoZSBjbGFpbSBieSBsb29raW5nIHVwIHRoZSB1c2VyJ3MgcHJvZmlsZS4KICoKICogVGhpcyByZXNvbHZlciB3aWxsIHJldHVybiBhIHZhbHVlIGZvciB0aGUgY2xhaW0gaWY6CiAqICMgdGhlIHVzZXIncyBwcm9maWxlIGF0dHJpYnV0ZSBpcyBub3QgbnVsbAogKiAjIEFORCB0aGUgY2xhaW0gY29udGFpbnMgbm8gcmVxdWVzdGVkIHZhbHVlcwogKiAjIE9SIHRoZSBjbGFpbSBjb250YWlucyByZXF1ZXN0ZWQgdmFsdWVzIGFuZCB0aGUgdmFsdWUgZnJvbSB0aGUgdXNlcidzIHByb2ZpbGUgaXMgaW4gdGhlIGxpc3Qgb2YgdmFsdWVzCiAqCiAqIElmIG5vIG1hdGNoIGlzIGZvdW5kIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uCiAqLwp1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIgPSB7IGF0dHJpYnV0ZSwgY2xhaW0sIGlkZW50aXR5IC0+CiAgICB1c2VyUHJvZmlsZVZhbHVlID0gZnJvbVNldChjbGFpbS5nZXROYW1lKCksIGlkZW50aXR5LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKQogICAgaWYgKHVzZXJQcm9maWxlVmFsdWUgIT0gbnVsbCAmJiAoY2xhaW0uZ2V0VmFsdWVzKCkgPT0gbnVsbCB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5pc0VtcHR5KCkgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuY29udGFpbnModXNlclByb2ZpbGVWYWx1ZSkpKSB7CiAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogdXNlclByb2ZpbGVWYWx1ZV0KICAgIH0KICAgIFs6XQp9CgovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCByZXNvbHZlcyB0aGUgdmFsdWUgb2YgdGhlIGNsYWltIGJ5IGxvb2tpbmcgdXAgdGhlIHVzZXIncyBwcm9maWxlLgogKgogKiBUaGlzIHJlc29sdmVyIHdpbGwgcmV0dXJuIGEgdmFsdWUgZm9yIHRoZSBjbGFpbSBpZjoKICogIyB0aGUgdXNlcidzIHByb2ZpbGUgYXR0cmlidXRlIGlzIG5vdCBudWxsCiAqICMgQU5EIHRoZSBjbGFpbSBjb250YWlucyBubyByZXF1ZXN0ZWQgdmFsdWVzCiAqICMgT1IgdGhlIGNsYWltIGNvbnRhaW5zIHJlcXVlc3RlZCB2YWx1ZXMgYW5kIHRoZSB2YWx1ZSBmcm9tIHRoZSB1c2VyJ3MgcHJvZmlsZSBpcyBpbiB0aGUgbGlzdCBvZiB2YWx1ZXMKICoKICogSWYgdGhlIGNsYWltIGlzIGVzc2VudGlhbCBhbmQgbm8gdmFsdWUgaXMgZm91bmQgYW4gSW52YWxpZFJlcXVlc3RFeGNlcHRpb24gd2lsbCBiZSB0aHJvd24gYW5kIHJldHVybmVkIHRvIHRoZSB1c2VyLgogKiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KZXNzZW50aWFsQ2xhaW1SZXNvbHZlciA9IHsgYXR0cmlidXRlLCBjbGFpbSwgaWRlbnRpdHkgLT4KICAgIHVzZXJQcm9maWxlVmFsdWUgPSBmcm9tU2V0KGNsYWltLmdldE5hbWUoKSwgaWRlbnRpdHkuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkpCiAgICBpZiAoY2xhaW0uaXNFc3NlbnRpYWwoKSAmJiAodXNlclByb2ZpbGVWYWx1ZSA9PSBudWxsIHx8IHVzZXJQcm9maWxlVmFsdWUuaXNFbXB0eSgpKSkgewogICAgICAgIHRocm93IG5ldyBJbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbigiQ291bGQgbm90IHByb3ZpZGUgdmFsdWUgZm9yIGVzc2VudGlhbCBjbGFpbSAkY2xhaW0iKQogICAgfQogICAgaWYgKHVzZXJQcm9maWxlVmFsdWUgIT0gbnVsbCAmJiAoY2xhaW0uZ2V0VmFsdWVzKCkgPT0gbnVsbCB8fCBjbGFpbS5nZXRWYWx1ZXMoKS5pc0VtcHR5KCkgfHwgY2xhaW0uZ2V0VmFsdWVzKCkuY29udGFpbnModXNlclByb2ZpbGVWYWx1ZSkpKSB7CiAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogdXNlclByb2ZpbGVWYWx1ZV0KICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFs6XQogICAgfQp9CgovKgogKiBDbGFpbSByZXNvbHZlciB3aGljaCBleHBlY3RzIHRoZSB1c2VyJ3MgcHJvZmlsZSBhdHRyaWJ1dGUgdmFsdWUgdG8gYmUgaW4gdGhlIGZvbGxvd2luZyBmb3JtYXQ6CiAqICJsYW5ndWFnZV90YWd8dmFsdWVfZm9yX2xhbmd1YWdlLC4uLiIuCiAqCiAqIFRoaXMgcmVzb2x2ZXIgd2lsbCB0YWtlIHRoZSBsaXN0IG9mIHJlcXVlc3RlZCBsYW5ndWFnZXMgZnJvbSB0aGUgJ2NsYWltc19sb2NhbGVzJyBhdXRob3JpemUgcmVxdWVzdAogKiBwYXJhbWV0ZXIgYW5kIGF0dGVtcHQgdG8gbWF0Y2ggaXQgdG8gYSB2YWx1ZSBmcm9tIHRoZSB1c2VycycgcHJvZmlsZSBhdHRyaWJ1dGUuCiAqIElmIG5vIG1hdGNoIGlzIGZvdW5kIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24uCiAqLwpjbGFpbUxvY2FsZXNDbGFpbVJlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgdXNlclByb2ZpbGVWYWx1ZSA9IGZyb21TZXQoY2xhaW0uZ2V0TmFtZSgpLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwpIHsKICAgICAgICBsb2NhbGVWYWx1ZXMgPSBwYXJzZUxvY2FsZUF3YXJlU3RyaW5nKHVzZXJQcm9maWxlVmFsdWUpCiAgICAgICAgbG9jYWxlID0gY2xhaW1zTG9jYWxlcy5maW5kIHsgbG9jYWxlIC0+IGxvY2FsZVZhbHVlcy5jb250YWluc0tleShsb2NhbGUpIH0KICAgICAgICBpZiAobG9jYWxlICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpKTogbG9jYWxlVmFsdWVzLmdldChsb2NhbGUpXQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBbOl0KfQoKLyoKICogQ2xhaW0gcmVzb2x2ZXIgd2hpY2ggZXhwZWN0cyB0aGUgdXNlcidzIHByb2ZpbGUgYXR0cmlidXRlIHZhbHVlIHRvIGJlIGluIHRoZSBmb2xsb3dpbmcgZm9ybWF0OgogKiAibGFuZ3VhZ2VfdGFnfHZhbHVlX2Zvcl9sYW5ndWFnZSwuLi4iLgogKgogKiBUaGlzIHJlc29sdmVyIHdpbGwgdGFrZSB0aGUgbGFuZ3VhZ2UgdGFnIHNwZWNpZmllZCBpbiB0aGUgY2xhaW0gb2JqZWN0IGFuZCBhdHRlbXB0IHRvIG1hdGNoIGl0IHRvIGEgdmFsdWUKICogZnJvbSB0aGUgdXNlcnMnIHByb2ZpbGUgYXR0cmlidXRlLiBJZiBubyBtYXRjaCBpcyBmb3VuZCBhbiBleGNlcHRpb24gaXMgdGhyb3duLgogKi8KbGFuZ3VhZ2VUYWdDbGFpbVJlc29sdmVyID0geyBhdHRyaWJ1dGUsIGNsYWltLCBpZGVudGl0eSAtPgogICAgdXNlclByb2ZpbGVWYWx1ZSA9IGZyb21TZXQoY2xhaW0uZ2V0TmFtZSgpLCBpZGVudGl0eS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSkKICAgIGlmICh1c2VyUHJvZmlsZVZhbHVlICE9IG51bGwpIHsKICAgICAgICBsb2NhbGVWYWx1ZXMgPSBwYXJzZUxvY2FsZUF3YXJlU3RyaW5nKHVzZXJQcm9maWxlVmFsdWUpCiAgICAgICAgaWYgKGNsYWltLmdldExvY2FsZSgpICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKGxvY2FsZVZhbHVlcy5jb250YWluc0tleShjbGFpbS5nZXRMb2NhbGUoKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBbKGNsYWltLmdldE5hbWUoKSk6IGxvY2FsZVZhbHVlcy5nZXQoY2xhaW0uZ2V0TG9jYWxlKCkpXQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZW50cnkgPSBsb2NhbGVWYWx1ZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpLm5leHQoKQogICAgICAgICAgICAgICAgcmV0dXJuIFsoY2xhaW0uZ2V0TmFtZSgpICsgIiMiICsgZW50cnkuZ2V0S2V5KCkpOiBlbnRyeS5nZXRWYWx1ZSgpXQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW50cnkgPSBsb2NhbGVWYWx1ZXMuZW50cnlTZXQoKS5pdGVyYXRvcigpLm5leHQoKQogICAgICAgICAgICByZXR1cm4gWyhjbGFpbS5nZXROYW1lKCkpOiBlbnRyeS5nZXRWYWx1ZSgpXQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBbOl0KfQoKLyoKICogR2l2ZW4gYSBzdHJpbmcgImVufEVuZ2xpc2gsanB8SmFwZW5lc2UsZnJfQ0F8RnJlbmNoIENhbmFkaWFuIiB3aWxsIHJldHVybiBtYXAgb2YgbG9jYWxlIC0+IHZhbHVlLgogKi8KcGFyc2VMb2NhbGVBd2FyZVN0cmluZyA9IHsgcyAtPgogICAgcmV0dXJuIHJlc3VsdCA9IHMuc3BsaXQoIiwiKS5jb2xsZWN0RW50cmllcyB7IGVudHJ5IC0+CiAgICAgICAgc3BsaXQgPSBlbnRyeS5zcGxpdCgiXFx8IikKICAgICAgICBbKHNwbGl0WzBdKTogdmFsdWUgPSBzcGxpdFsxXV0KICAgIH0KfQovLyAtLS1eXl5eXl5eXl5eLS0tIEVYQU1QTEUgQ0xBSU0gQVRUUklCVVRFIFJFU09MVkVSIEZVTkNUSU9OUyAtLS1eXl5eXl5eXl5eLS0tCgovLyAtLS0tLS0tLS0tLS0tLSBVUERBVEUgVEhJUyBUTyBDSEFOR0UgQ0xBSU0gVE8gQVRUUklCVVRFIE1BUFBJTkcgRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLQovKgogKiBMaXN0IG9mIGNsYWltIHJlc29sdmVyIG1hcHBpbmdzLgogKi8KLy8gWyB7Y2xhaW19OiB7YXR0cmlidXRlIHJldHJpZXZlcn0sIC4uLiBdCmNsYWltQXR0cmlidXRlcyA9IFsKICAgICAgICAiZW1haWwiOiB1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIuY3VycnkoIm1haWwiKSwKICAgICAgICAiYWRkcmVzcyI6IHsgY2xhaW0sIGlkZW50aXR5IC0+IFsgImZvcm1hdHRlZCIgOiB1c2VyUHJvZmlsZUNsYWltUmVzb2x2ZXIoInBvc3RhbGFkZHJlc3MiLCBjbGFpbSwgaWRlbnRpdHkpIF0gfSwKICAgICAgICAicGhvbmVfbnVtYmVyIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJ0ZWxlcGhvbmVudW1iZXIiKSwKICAgICAgICAiZ2l2ZW5fbmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgiZ2l2ZW5uYW1lIiksCiAgICAgICAgInpvbmVpbmZvIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJwcmVmZXJyZWR0aW1lem9uZSIpLAogICAgICAgICJmYW1pbHlfbmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgic24iKSwKICAgICAgICAibG9jYWxlIjogdXNlclByb2ZpbGVDbGFpbVJlc29sdmVyLmN1cnJ5KCJwcmVmZXJyZWRsb2NhbGUiKSwKICAgICAgICAibmFtZSI6IHVzZXJQcm9maWxlQ2xhaW1SZXNvbHZlci5jdXJyeSgiY24iKQpdCgoKLy8gLS0tLS0tLS0tLS0tLS0gVVBEQVRFIFRISVMgVE8gQ0hBTkdFIFNDT1BFIFRPIENMQUlNIE1BUFBJTkdTIC0tLS0tLS0tLS0tLS0tCi8qCiAqIE1hcCBvZiBzY29wZXMgdG8gY2xhaW0gb2JqZWN0cy4KICovCi8vIHtzY29wZX06IFsge2NsYWltfSwgLi4uIF0Kc2NvcGVDbGFpbXNNYXAgPSBbCiAgICAgICAgImVtYWlsIjogWyAiZW1haWwiIF0sCiAgICAgICAgImFkZHJlc3MiOiBbICJhZGRyZXNzIiBdLAogICAgICAgICJwaG9uZSI6IFsgInBob25lX251bWJlciIgXSwKICAgICAgICAicHJvZmlsZSI6IFsgImdpdmVuX25hbWUiLCAiem9uZWluZm8iLCAiZmFtaWx5X25hbWUiLCAibG9jYWxlIiwgIm5hbWUiIF0KXQoKCi8vIC0tLS0tLS0tLS0tLS0tLS0gVVBEQVRFIEJFTE9XIEZPUiBBRFZBTkNFRCBVU0FHRVMgLS0tLS0tLS0tLS0tLS0tLS0tLQppZiAobG9nZ2VyLm1lc3NhZ2VFbmFibGVkKCkpIHsKICAgIHNjb3Blcy5maW5kQWxsIHsgcyAtPiAhKCJvcGVuaWQiLmVxdWFscyhzKSB8fCBzY29wZUNsYWltc01hcC5jb250YWluc0tleShzKSkgfS5lYWNoIHsgcyAtPgogICAgICAgIGxvZ2dlci5tZXNzYWdlKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOjpNZXNzYWdlOiBzY29wZSBub3QgYm91bmQgdG8gY2xhaW1zOiAkcyIpCiAgICB9Cn0KCi8qCiAqIENvbXB1dGVzIHRoZSBjbGFpbXMgcmV0dXJuIGtleSBhbmQgdmFsdWUuIFRoZSBrZXkgbWF5IGJlIGEgZGlmZmVyZW50IHZhbHVlIGlmIHRoZSBjbGFpbSB2YWx1ZSBpcyBub3QgaW4KICogdGhlIHJlcXVlc3RlZCBsYW5ndWFnZS4KICovCmRlZiBjb21wdXRlQ2xhaW0gPSB7IGNsYWltIC0+CiAgICB0cnkgewogICAgICAgIGNsYWltUmVzb2x2ZXIgPSBjbGFpbUF0dHJpYnV0ZXMuZ2V0KGNsYWltLmdldE5hbWUoKSwgeyBjbGFpbU9iaiwgaWRlbnRpdHkgLT4gZGVmYXVsdENsYWltUmVzb2x2ZXIoY2xhaW0pfSkKICAgICAgICBjbGFpbVJlc29sdmVyKGNsYWltLCBpZGVudGl0eSkKICAgIH0gY2F0Y2ggKElkUmVwb0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgaWYgKGxvZ2dlci53YXJuaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCJPcGVuQU1TY29wZVZhbGlkYXRvci5nZXRVc2VySW5mbygpOiBVbmFibGUgdG8gcmV0cmlldmUgYXR0cmlidXRlPSRhdHRyaWJ1dGUiLCBlKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChTU09FeGNlcHRpb24gZSkgewogICAgICAgIGlmIChsb2dnZXIud2FybmluZ0VuYWJsZWQoKSkgewogICAgICAgICAgICBsb2dnZXIud2FybmluZygiT3BlbkFNU2NvcGVWYWxpZGF0b3IuZ2V0VXNlckluZm8oKTogVW5hYmxlIHRvIHJldHJpZXZlIGF0dHJpYnV0ZT0kYXR0cmlidXRlIiwgZSk7CiAgICAgICAgfQogICAgfQp9CgovKgogKiBDb252ZXJ0cyByZXF1ZXN0ZWQgc2NvcGVzIGludG8gY2xhaW0gb2JqZWN0cyBiYXNlZCBvbiB0aGUgc2NvcGUgbWFwcGluZ3MgaW4gc2NvcGVDbGFpbXNNYXAuCiAqLwpkZWYgY29udmVydFNjb3BlVG9DbGFpbXMgPSB7CiAgICBzY29wZXMuZmluZEFsbCB7IHNjb3BlIC0+ICJvcGVuaWQiICE9IHNjb3BlICYmIHNjb3BlQ2xhaW1zTWFwLmNvbnRhaW5zS2V5KHNjb3BlKSB9LmNvbGxlY3RNYW55IHsgc2NvcGUgLT4KICAgICAgICBzY29wZUNsYWltc01hcC5nZXQoc2NvcGUpLmNvbGxlY3QgeyBjbGFpbSAtPgogICAgICAgICAgICBuZXcgQ2xhaW0oY2xhaW0pCiAgICAgICAgfQogICAgfQp9CgovLyBDcmVhdGVzIGEgZnVsbCBsaXN0IG9mIGNsYWltcyB0byByZXNvbHZlIGZyb20gcmVxdWVzdGVkIHNjb3BlcywgY2xhaW1zIHByb3ZpZGVkIGJ5IEFTIGFuZCByZXF1ZXN0ZWQgY2xhaW1zCmRlZiBjbGFpbXNUb1Jlc29sdmUgPSBjb252ZXJ0U2NvcGVUb0NsYWltcygpICsgY2xhaW1PYmplY3RzICsgcmVxdWVzdGVkVHlwZWRDbGFpbXMKCi8vIENvbXB1dGVzIHRoZSBjbGFpbSByZXR1cm4ga2V5IGFuZCB2YWx1ZXMgZm9yIGFsbCByZXF1ZXN0ZWQgY2xhaW1zCmNvbXB1dGVkQ2xhaW1zID0gY2xhaW1zVG9SZXNvbHZlLmNvbGxlY3RFbnRyaWVzKCkgeyBjbGFpbSAtPgogICAgcmVzdWx0ID0gY29tcHV0ZUNsYWltKGNsYWltKQp9CgovLyBDb21wdXRlcyBjb21wb3NpdGUgc2NvcGVzCmRlZiBjb21wb3NpdGVTY29wZXMgPSBzY29wZUNsYWltc01hcC5maW5kQWxsIHsgc2NvcGUgLT4KICAgIHNjb3Blcy5jb250YWlucyhzY29wZS5rZXkpCn0KCnJldHVybiBuZXcgVXNlckluZm9DbGFpbXMoKE1hcCljb21wdXRlZENsYWltcywgKE1hcCljb21wb3NpdGVTY29wZXMp",
    "default" : true,
    "language" : "GROOVY",
    "context" : "OIDC_CLAIMS",
    "createdBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate" : 1433147666269,
    "lastModifiedBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate" : 1433147666269
  }
}
